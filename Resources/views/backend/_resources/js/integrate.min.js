function JSONParseSafe(t){try{return JSON.parse(t)}catch(t){return null}}function receiveSettings(t){if(t.origin===location.origin)return receiveInternalData(t);const e=t.data;if("string"==typeof e)if(e.startsWith("sync:")||e.startsWith("showPastOrdersInitial:")){const t=e.split(":"),s={type:"handle_past_orders"};s[t[0]]=t[1],this.submitPastOrdersCommand(s)}else if(e.startsWith("resync")){const t={type:"handle_past_orders",resync:"resync"};this.submitPastOrdersCommand(t)}else if(e.startsWith("issynced")){const t={type:"handle_past_orders",issynced:"issynced"};this.submitPastOrdersCommand(t)}else if(e.startsWith("check_product_skus")){const t=e.split(":"),s={type:"check_product_skus"};s.skuSelector=t[1]}else handleJSONMessage(e)}function submitPastOrdersCommand(t){const e=new XMLHttpRequest;e.open("POST",ajaxurl,!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.onreadystatechange=function(){4===e.readyState&&(e.status>=400?console.log(`callback error: ${e.response} ${e.status}`):sendPastOrdersInfo(e.response))},e.send(encodeSettings(t))}function sendPastOrdersInfo(t){const e=document.getElementById("configuration_iframe"),s=e.dataset,n=e.src;void 0===t&&(t=s.pastOrders),e.contentWindow.postMessage(t,n)}function checkProtocol(t){if(t.startsWith("//")){return window.location.protocol+t}return t}function receiveInternalData(t){const e=t.data;if(e&&"string"==typeof e){const t=JSONParseSafe(e);t&&"loadCategoryProductInfo"===t.type&&requestCategoryInfo(),t&&"updatePageUrls"===t.type&&submitSettings(t),t&&"newTrustBox"===t.type&&submitSettings(t)}}function requestCategoryInfo(){const t=new XMLHttpRequest;t.onreadystatechange=function(){4===t.readyState&&(t.status>=400?console.log(`callback error: ${t.response} ${t.status}`):window.postMessage(JSON.stringify(t.response),window.origin))},t.open("POST",ajaxurl,!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.send(encodeSettings({type:"get_category_product_info"}))}function handleJSONMessage(t){try{const e=JSON.parse(t);if(e.window)this.updateIframeSize(e);else if("submit"===e.type)this.submitSettings(e);else if(e.showTotalOrders){const t={type:"handle_past_orders",showTotalOrders:e.showTotalOrders};this.submitPastOrdersCommand(t)}else"updatePageUrls"!==e.type&&"newTrustBox"!==e.type||this.submitSettings(e)}catch(t){}}function updateIframeSize(t){const e=document.getElementById("configuration_iframe");e&&(e.height=t.window.height+"px")}function submitSettings(t){let e={type:"handle_save_changes"};"updatePageUrls"===t.type?e.pageUrls=encodeURIComponent(JSON.stringify(t.pageUrls)):"newTrustBox"===t.type?e.customTrustBoxes=encodeURIComponent(JSON.stringify(t)):e.settings=encodeURIComponent(JSON.stringify(t.settings));const s=new XMLHttpRequest;s.open("POST",ajaxurl),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.send(encodeSettings(e))}function encodeSettings(t){let e="";for(const s in t)e+=`${s}=${t[s]}&`;return e.substring(0,e.length-1)}function sendSettings(){const t=document.getElementById("configuration_iframe"),e=t.dataset,s=JSONParseSafe(atob(e.settings)),n=t.src;if(s.trustbox||(s.trustbox={}),s.trustbox.pageUrls=JSONParseSafe(atob(e.pageUrls)),s.pluginVersion=e.pluginVersion,s.source=e.source,s.version=e.version,s.basis="plugin",s.productIdentificationOptions=JSONParseSafe(e.productIdentificationOptions),s.isFromMarketplace=e.isFromMarketplace,s.customTrustBoxes=e.customTrustboxes,s.configurationScopeTree=JSONParseSafe(atob(e.configurationScopeTree)),s.pluginStatus=JSONParseSafe(atob(e.pluginStatus)),s.shop=e.shop,s.locale=e.locale,s.trustbox.trustboxes&&e.sku)for(trustbox of s.trustbox.trustboxes)trustbox.sku=e.sku;if(s.trustbox.trustboxes&&e.name)for(trustbox of s.trustbox.trustboxes)trustbox.name=e.name;t.contentWindow.postMessage(JSON.stringify(s),n)}window.addEventListener("message",this.receiveSettings);
//# sourceMappingURL=integrate.min.js.map
